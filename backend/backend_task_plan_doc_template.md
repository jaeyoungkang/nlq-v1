# 리팩토링 계획서 작성 지침

> nlq-v1 백엔드 리팩토링을 위한 표준 계획서 템플릿
> auth 분리 프로젝트 성공 사례를 기반으로 작성

## 📋 계획서 구성 요소

### 1. 제목 및 개요
- **명확한 제목**: `[기능명] 기능 분리 계획서` 형식 사용
- **현재 상태**: 파일 위치, 라인 수, 주요 문제점 간단 명시
- **문제 정의**: 모놀리식 구조, 계층 분리 미흡 등 핵심 이슈 3-4개

### 2. 목표 구조 (ASCII 트리)
```
features/[기능명]/
├── models.py       # 데이터 모델
├── repositories.py # 데이터 접근 계층
├── services.py     # 비즈니스 로직
└── routes.py      # API 엔드포인트

utils/
├── [관련_utils].py # 공통 유틸리티
```

### 3. 기능 매핑 (현재 → 목표)
- **기존 클래스/함수 → 새로운 위치**로 명확한 매핑 제시
- 각 기능이 어느 계층으로 이동하는지 명시
- "그대로 이관" vs "분리/통합" 구분

### 4. 마이그레이션 단계
1. **구조 생성**: 디렉토리 및 빈 파일 생성
2. **공통 유틸 분리**: 재사용 가능한 유틸리티 먼저 분리
3. **Repository 구현**: 데이터 접근 로직 분리
4. **Service 구현**: 비즈니스 로직 이관
5. **유틸/데코레이터 분리**: 공통 기능 분리
6. **라우트 이관**: Controller 계층 의존성 주입 적용
7. **의존성 연결**: app.py에서 초기화
8. **기존 파일 제거**: 레거시 코드 정리

### 5. 구현 시 준수사항
**CLAUDE.md 기준 필수 적용:**
- **계층 간 의존성**: Controller → Service → Repository (상위→하위만)
- **API 계약**: ErrorResponse/SuccessResponse 클래스 사용 필수
- **에러 처리**: utils.logging_utils.get_logger() 사용 필수
- **인증 데코레이터**: 모든 API 엔드포인트에 @require_auth 적용

## 📊 구현 완료 후 추가 내용

### 7. 실제 구현 완료 섹션
```markdown
## 실제 구현 완료 (YYYY-MM-DD)

### ✅ 완료된 작업 내역
#### 1-5. [각 단계별 상세 구현 내용]

### 📊 구현 결과
#### 아키텍처 준수
- ✅ Controller → Service → Repository 계층 흐름
- ✅ 표준 응답/로깅/인증 적용

#### 의존성 주입
- [주요 의존성 주입 패턴 설명]

```

## 🎯 작성 가이드라인

### 내용 원칙
1. **간결성**: 1페이지 이내 (구현 완료 섹션 제외)
2. **구체성**: 파일명, 클래스명, 함수명까지 명시
3. **실행 가능성**: 단계별로 실제 수행 가능한 작업 정의
4. **표준 준수**: CLAUDE.md 아키텍처 기준 반드시 포함

### 작성 프로세스
1. **분석**: 현재 상태 파악 (파일 크기, 의존성, 문제점)
2. **설계**: 목표 구조 및 기능 매핑 정의
3. **계획**: 상세 작업 정의
4. **검토**: CLAUDE.md 준수사항 체크
5. **실행**: 단계별 구현 후 완료 내역 문서화

### 품질 체크리스트
- [ ] 목표 구조가 기능 주도 아키텍처를 따르는가?
- [ ] CLAUDE.md 아키텍처 기준이 모두 포함되었는가?

이 지침을 활용하여 일관된 품질의 리팩토링 계획서를 작성하고, 체계적인 코드 개선을 진행하세요.