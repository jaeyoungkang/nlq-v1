# 백엔드 개발 계획서 작성 지침

> nlq-v1 백엔드 개발을 위한 체계적 분석 및 계획 방법론  
> **리팩토링, 신규 기능 개발, 아키텍처 개선 등 모든 개발 작업에 적용**  
> **개발 표준은 CLAUDE.md 참조** - 이 문서는 순수하게 계획 프로세스에 집중

## 📋 계획서 구성 요소

### 1. 포괄적 현황 분석 (필수)
#### 1.1 대상 분석
- **주 대상 파일**: 위치, 크기(라인 수), 주요 클래스/함수
- **관련 파일/폴더 전체 조사**:
  - 대상이 import하는 모든 모듈
  - 대상을 import하는 모든 코드
  - 같은 디렉토리의 관련 파일/폴더
  - 관련 테스트, 문서, 설정 파일

#### 1.2 문제 정의
- **아키텍처 문제**: 모놀리식 구조, 계층 분리 미흡 등
- **의존성 문제**: 순환 참조, 과도한 결합 등
- **확장성 문제**: 새 기능 추가 시 어려움

### 2. 아키텍처 원칙 검토
#### 2.1 각 컴포넌트 분류
각 파일/모듈을 다음 기준으로 분류:
- **core**: 도메인 모델, 비즈니스 자산, 인프라 인터페이스
- **features**: 구체적 구현, 비즈니스 로직
- **utils**: 범용 유틸리티 (도메인 독립적)

#### 2.2 분류 근거 제시
| 컴포넌트 | 현재 위치 | 제안 위치 | 근거 |
|---------|----------|----------|------|
| 예시 | utils/ | core/ | 비즈니스 자산이므로 |

### 3. 목표 구조 (ASCII 트리)
```
core/                # 도메인 자산과 인터페이스
├── models/         # 공유 도메인 모델
├── [도메인자산]/   # 비즈니스 핵심 자산
└── [인프라]/       # 인프라 추상화

features/[기능명]/
├── models.py       # 기능별 데이터 모델
├── repositories.py # 데이터 접근 구현
├── services.py     # 비즈니스 로직
├── utils.py        # 기능 전용 유틸
└── routes.py       # API 엔드포인트

utils/
└── [범용_utils].py # 도메인 독립적 유틸
```

### 4. 기능 매핑 (현재 → 목표)
- **기존 클래스/함수 → 새로운 위치**로 명확한 매핑 제시
- 각 기능이 어느 계층으로 이동하는지 명시
- "그대로 이관" vs "분리/통합" 구분

### 5. 의존성 및 영향 범위 분석
#### 5.1 직접 의존성
- 대상을 사용하는 모든 코드 목록
- 각 사용처에서 필요한 변경사항

#### 5.2 간접 영향
- 테스트 코드 수정 필요성
- 문서 업데이트 필요성
- 설정 파일 변경 필요성

#### 5.3 하위 호환성
- 점진적 마이그레이션 필요 여부
- 임시 Adapter 패턴 필요 여부

### 6. 마이그레이션 단계
1. **구조 생성**: 디렉토리 및 빈 파일 생성
2. **공통 유틸 분리**: 재사용 가능한 유틸리티 먼저 분리
3. **Repository 구현**: 데이터 접근 로직 분리
4. **Service 구현**: 비즈니스 로직 이관
5. **유틸/데코레이터 분리**: 공통 기능 분리
6. **라우트 이관**: Controller 계층 의존성 주입 적용
7. **의존성 연결**: app.py에서 초기화
8. **기존 파일 제거**: 레거시 코드 정리

### 7. 구현 시 준수사항

#### 7.1 개발 표준 준수
- **CLAUDE.md 필수 참조**: 아키텍처 원칙, API 계약, 에러 처리 등 모든 개발 표준
- **계획 단계에서 확인**: 설계가 CLAUDE.md 기준을 충족하는지 사전 검토

#### 7.2 도메인 모델 고려사항
- **ContextBlock 설계**: CLAUDE.md의 ContextBlock 설계 원칙 준수 확인
- **데이터 모델**: 공유 모델과 기능별 모델 적절한 분리
- **유틸리티 활용**: 모델 전용 헬퍼 함수 활용 계획

## 📊 구현 완료 후 추가 내용

### 8. 실제 구현 완료 섹션
```markdown
## 실제 구현 완료 (YYYY-MM-DD)

### ✅ 완료된 작업 내역
#### 1-5. [각 단계별 상세 구현 내용]

### 📊 구현 결과
#### 아키텍처 준수
- ✅ Controller → Service → Repository 계층 흐름
- ✅ 표준 응답/로깅/인증 적용

#### 의존성 주입
- [주요 의존성 주입 패턴 설명]

```

## 🎯 작성 가이드라인

### 내용 원칙
1. **포괄성**: 관련된 모든 파일/폴더 조사 필수
2. **근거 제시**: 각 결정에 대한 명확한 이유
3. **구체성**: 파일명, 클래스명, 함수명까지 명시
4. **실행 가능성**: 단계별로 실제 수행 가능한 작업 정의
5. **표준 준수**: CLAUDE.md 아키텍처 기준 반드시 포함

### 작성 프로세스
1. **포괄적 조사**: 대상과 관련된 모든 요소 파악
   - "관련된 모든", "전체 구조" 키워드 활용
   - 직접/간접 의존성 모두 확인
2. **아키텍처 분류**: core/features/utils 적절성 판단
   - 도메인 자산 vs 유틸리티 구분
   - 현재 위치의 적절성도 재검토
3. **영향 분석**: 변경 시 영향받는 모든 부분 파악
4. **설계**: 목표 구조 및 기능 매핑 정의
5. **계획**: 상세 마이그레이션 단계 정의
6. **검토**: CLAUDE.md 준수사항 체크
7. **실행**: 단계별 구현 후 완료 내역 문서화

### 품질 체크리스트
- [ ] 관련된 모든 파일/폴더를 조사했는가?
- [ ] 각 컴포넌트의 core/features/utils 분류가 적절한가?
- [ ] 목표 구조가 기능 주도 아키텍처를 따르는가?
- [ ] 의존성 및 영향 범위를 완전히 파악했는가?
- [ ] **CLAUDE.md 개발 표준을 모두 검토했는가?**
  - [ ] 아키텍처 원칙 준수 계획이 있는가?
  - [ ] API 계약 및 에러 처리 표준 적용 계획이 있는가?
  - [ ] 도메인 모델 설계 원칙을 따르는가?
- [ ] 누락된 요소가 없는지 재확인했는가?


#### LLM 지시사항 템플릿
Claude Code에게 리팩토링 작업 지시 시 다음 템플릿 활용:

```
"[대상] 리팩토링 작업을 수행하라.
1. CLAUDE.md의 개발 표준을 모두 준수하라
2. 계획서에 따라 단계별로 진행하라
3. 각 단계 완료 후 체크리스트 항목들을 확인하라
4. 문제가 발생하면 CLAUDE.md를 재참조하여 해결하라"
```

## 📚 참조 문서

- **[CLAUDE.md](./CLAUDE.md)**: 백엔드 개발 표준 (아키텍처 원칙, API 계약, 코딩 규칙)
- **이 문서**: 개발 계획 작성 방법론 (리팩토링 & 신규 기능 개발)

## 🎯 사용법

### 리팩토링 계획 시
- 섹션 A 중심으로 활용
- 기존 코드 분석 → 아키텍처 재구성 → 마이그레이션 계획

### 신규 기능 개발 계획 시  
- 섹션 B 중심으로 활용
- 요구사항 분석 → 아키텍처 설계 → 단계별 개발 계획

이 지침을 활용하여 체계적인 개발 계획서를 작성하고, 구현 시에는 CLAUDE.md를 참조하세요.